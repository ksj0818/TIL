## 세션 or 토큰

- `세션 기반 인증`
  서버 측에 클라이언트의 접속 상태를 저장하는 세션 기반의 인증.
  Client(Web browser) > Server(Web Server) > Session Storage(file, DB, Memory)
  기본 프로세스는 사용자의 인증(ID/PW)이 완료되면 서버는 세션을 발급함.
  이후 서버는 세션 값을 포함한 클라이언트의 상태를 세션 스토리지에 저장. 
  클라이언트 또한 자신의 세션 값을 클라이언트에 저장(주로 쿠키)함.
  클라이언트는 데이터 요청 시 쿠키에 저장된 세션 값을 함께 보내며, 서버에서는 이 세션 값을 세션 스토리지를 통해 검증한 후 데이터를 응답함.

- `토큰기반인증`
  토큰은 사용자 인증을 위한 정보를 서명한 것.
  토큰에 사용자 인증을 위한 정보가 담겨있기 때문에 서버에 사용자 정보를 서버에 저장하지 않고, 전달받은 토큰의 서명과 데이터를 검증하는 것만으로 인증이 가능.
  사용자 인증이 완료되면 서버는 비밀키 또는 공개/개인 키를 이용해 서명한 토큰을 클라이언트에게 전달함. 그리고 데이터 요청 시 클라이언트는 토큰을 포함함(주로 헤더). 서버는 토큰의 서명 값을 이용하여 토큰이 유효한지 검증. 유효한 토큰인 경우 요청에 응답.
  토큰 발급 시 토큰 내 권한 정보를 추가하여 권한에 맞는 데이터 응답도 가능.

- Session, Token 차이점
  `정보 포함`: 세션 값 자체에는 정보가 포함되지 않지만, 토큰 값에는 정보가 포함됨.
  `상태 정보 미저장`: 세션 방식은 상태 정보를 서버 내에 저장하고 있음. 이에 비해
  토큰은 기본적으로 서버에 클라이언트 상태를 저장하지 않는 무상태성 방식.

- `JWT(JSON Web Token)`
  현재 토큰 인증에서 가장 많이 사용되는 인터넷 표준.
  app의 액세스 토큰을 만드는 데 주로 사용됨.
  데이터들이 JSON형태로 작성되며, 데이터를 비밀키 또는 공개/개인 키로 서명해 사용함.
  이를 통해 JWT는 인가와 정보 교환을 위해 사용될 수 있음.
  사용자에게 발급된 토큰으로 인가된 서버 리소스에 접근할 수 있음.
  또한 공개/개인 키를 사용해 서명함으로써 송신자를 확인, 데이터의 무결성도 확인

- JWT 구조

  1. header (헤더)
     토큰 타입을 명시하는 'typ'와 HMAC, SHA256등의 서명 알고리즘을 적는 'alg'로 이루어짐

  2. payload (페이로드)
     페이로드에는 토큰을 담을 데이터가 들어있음.
     이 데이터 하나를 JWT에서는 claim이라고 부름.
     claim에는 registered, public, private claims 세 가지 종류가 존재.

     `Registered claims`는 서비스에 필요한 정보가 아닌 토큰에 관한 정보를 담기 위해 이미 등록된 클레임입니다. 반드시 사용할 필요 없이 선택적으로 사용할 수 있습니다.

     `Public claims`는 사용자가 정의할 수 있는 클레임입니다. 이 클레임은 충돌 방지를 위해 IANA(Internet Assigned Numbers Authority) JSON 웹 토큰 레지스트리에 정의하거나, 충돌 방지 네임스페이스를 포함하는 URI로 클레임 이름을 정의해야 합니다.

     `Private claims`는 토큰 사용자 간(서버-클라이언트) 정보 공유를 위해 만들어 사용하는 클레임으로 충돌이 발생할 수 있으니 주의해야 합니다.

  3. 서명
     서명 부분은 헤더와 페이로드를 서명한 값입니다. 시크릿 키를 이용해 base64 url로 인코딩한 헤더와 페이로드를 헤더에 규정된 해싱 알고리즘으로 서명합니다. 서버는 이 서명과 전달된 헤더, 페이로드를 같은 알고리즘으로 해시한 값이 동일한 것을 확인함으로써 유효한 토큰인지 검사합니다.

- JWT 특징
   JWT는 JSON 형식을 사용해 더 간결하기 때문에 HTTP 환경에서 잘 전달될 수 있음.
   JWT는 토큰 구조만을 정의, 인터넷의 여러 플랫폼에서 사용되며 특히 모바일에서 많이 사용

- 정보 노출
  JWT의 페이로드에는 클라이언트와 서버가 사용할 데이터를 저장함.
  이 데이터는 암호화되지 않고, base64로 인코딩한 값임.
  base64로 인코딩된 값은 누구나 디코딩해 데이터를 확인할 수 있음.
  따라서 페이로드에는 중요 정보, 민감 정보 등을 포함하지 않아야 함