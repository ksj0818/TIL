/**
 * promise
 * jsì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë™ê¸°ë¥¼ ê°„íŽ¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸,
 * ì •í•´ì§„ ìž¥ì‹œê°„ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³  ë‚˜ì„œ ì •ìƒì ìœ¼ë¡œ ê¸°ëŠ¥ì´ ìˆ˜í–‰ë˜ì–´ì¡Œë‹¤ë©´
 * ì„±ê³µì˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³ , ë§Œì•½ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ë©´ ì—ëŸ¬ë¥¼
 * ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í•  ë•Œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ì“¸ ìˆ˜ ìžˆëŠ” ìœ ìš©í•œ í•¨ìˆ˜
 * ë”± 2ê°€ì§€ë§Œ í¬ì¸íŠ¸ë¥¼ ìž¡ê³  ê³µë¶€í•˜ê¸°
 * 1. state (ìƒíƒœ)
 * í”„ë¡œì„¸ìŠ¤ê°€ ë¬´ê±°ìš´ ì˜¤í¼ë ˆì´ì…˜ì„ ìˆ˜í–‰í•˜ê³  ìžˆëŠ”ì§€ ì•„ë‹ˆë©´ ê¸°ëŠ¥ìˆ˜í–‰ì´ ë‹¤ ì™„ë£Œë˜ì–´ì„œ ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì´ëŸ° ìƒíƒœì— ëŒ€í•´ì„œ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”.
 * í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì ¸ì„œ ìš°ë¦¬ê°€ ì§€ì •í•œ ì˜¤í¼ë ˆì´ì…˜ì´ ìˆ˜í–‰ ì¤‘ì¼ë•ŒëŠ” - pending ìƒíƒœê°€ ë˜ê³ ,
 * ì´ ì˜¤í¼ë ˆì´ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ë‹¤ ë§ˆì¹˜ê²Œ ë˜ë©´ - fulfilled ìƒíƒœê°€ ë¨,
 * íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ë‹¤ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê¸¸ ì‹œ rejected ìƒíƒœê°€ ë¨
 * 2. producerì™€ consumer ì°¨ì´ì ì„ ì•Œê¸°.
 * ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ì‚¬ëžŒê³¼ ì´ ì œê³µëœ ë°ì´í„°ë¥¼ ì“°ëŠ” ì‚¬ëžŒ ì´ ë‘ ê°€ì§€ì˜ ì°¨ì´ì ì„ ìž˜ ì´í•´í•˜ê¸°
 * ì½œë°±ì„ ì“°ì§€ì•Šê³  promise ì˜¤ë¸Œì íŠ¸ë¥¼ í†µí•´ì„œ ë¹„ë™ê¸° ì½”ë“œë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìžˆëŠ”ì§€ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê¸°
 */

// 1. Producer
const promise = new Promise((resolve, reject) => {
  // í”„ë¡œë¯¸ìŠ¤ì˜ ìƒì„±ìžë¥¼ ë³´ë©´ executorë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ ì¤˜ì•¼í•˜ëŠ”ë° ì´ ì½œë°±í•¨ìˆ˜ì—ëŠ” ë˜ ë‹¤ë¥¸ 2ê°€ì§€ì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ë°›ìŒ(resolve, reject)
  // ë„¤íŠ¸ì›Œí¬ í†µì‹ , íŒŒì¼ì„ ì½ì–´ì˜¤ê¸° ë“± ì´ëŸ°ê²ƒë“¤ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
  // ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì§ˆ ë•ŒëŠ” ìš°ë¦¬ê°€ ì „ë‹¬í•œ executorë¼ëŠ” ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ìžë™ì ìœ¼ë¡œ ì‹¤í–‰ë¨
  console.log("doing something...");
  // í”„ë¡œë¯¸ìŠ¤ ì•ˆì—ì„œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ëŠ” ê²ƒì²˜ëŸ¼ setTimeoutì„ ì´ìš©í•´ì„œ ì‹œê°„ì„ ë”œë ˆì´ í•˜ê¸°
  setTimeout(() => {
    // resolve('gogildong')  // ì„±ê³µì ìœ¼ë¡œ ê°€ê³µí•œ ë°ì´í„°ë¥¼ ì „ë‹¬
    reject(new Error("no network")); // rejectëŠ” ë³´í†µ ì—ëŸ¬ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ í†µí•´ì„œ ê°’ì„ ì „ë‹¬
  }, 2000);
});

// 2. Consumers: then, catch, finallyë¥¼ ì´ìš©í•´ì„œ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìžˆìŒ.
promise
  .then((value) => {
    // then()ì˜ íŒŒë¼ë¯¸í„°(value)ëŠ” resolve ì½œë°±í•¨ìˆ˜ì—ì„œ ì „ë‹¬ëœ ê°’ì´ ë“¤ì–´ì˜´
    console.log(value);
  })
  .catch((error) => {
    // catch()ë¥¼ ì´ìš©í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ë•Œ ì–´ë–»ê²Œ ì²˜ë¦¬í• ê±´ì§€ ì½œë°±í•¨ìˆ˜ë¥¼ ë“±ë¡í•´ì£¼ê¸°
    console.log(error);
  })
  .finally(() => {
    // finally()ëŠ” ì„±ê³µí•˜ë˜ ì‹¤íŒ¨í•˜ë˜ ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— í˜¸ì¶œí•¨
    console.log("finally ë§ˆì§€ë§‰ì— ë¬´ì¡°ê±´ í˜¸ì¶œí•¨");
  });

// 3. Promise chaining
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});
// ì—¬ëŸ¬ê°€ì§€ë¥¼ ë™ì‹œì— ë¬¶ì–´ì„œ ë‹¤ë¥¸ ë¹„ë™ê¸°ì ì¸ ê²ƒë“¤ì„ ì²˜ë¦¬í•  ìˆ˜ ìžˆìŒ
fetchNumber
  .then((num) => num * 2)
  .then((num) => num * 3)
  .then((num) => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000);
    });
  })
  .then((num) => console.log(num));

// 4. Error Handling í”„ë¡œë¯¸ìŠ¤ë¥¼ ì²´ì´ë‹ í–ˆì„ ë•Œ ì–´ë–»ê²Œ ì—ëŸ¬ë¥¼ í•¸ë“¤ë§ í•  ìˆ˜ ìžˆëŠ”ì§€ ì•Œì•„ë³´ê¸°
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve("ðŸ“"), 1000);
  });
const getEgg = (hen) =>
  new Promise((resolve, reject) => {
    setTimeout(() => {
      // resolve(`${hen} => ðŸ¥š`);
      reject(`${hen} => ðŸ—`);
    }, 1000);
  });
const cook = (egg) =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ðŸ³`), 1000);
  });

getHen()
  .then((hen) => getEgg(hen))
  .catch((error) => "ðŸ—") // ì¤‘ê°„ì— ì—ëŸ¬ê°€ ìƒê²¨ë„ ì „ì²´ì ì¸ í”„ë¡œë¯¸ìŠ¤ ì²´ì¸ì— ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì˜ˆì™¸ì²˜ë¦¬ í•´ì£¼ê¸°
  .then(cook) // egg => cook(egg)ë¥¼ ìƒëžµí•˜ê³  cookë§Œ í˜¸ì¶œ, (ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•  ë•Œ ë°›ì•„ì˜¤ëŠ” ë°¸ë¥˜ë¥¼ ë‹¤ìŒí•¨ìˆ˜ë¡œ ë°”ë¡œ í•˜ë‚˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ” ìƒëžµê°€ëŠ¥) *ì¸ìžê°€ ë˜‘ê°™ìœ¼ë©´ ìƒëžµê°€ëŠ¥
  .then((meal) => console.log(meal))
  .catch(console.log);
